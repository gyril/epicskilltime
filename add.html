<!DOCTYPE html>
<meta charset="utf-8">

  <head>
    <title>EpicSkillTime</title>
    <link rel="icon" type="image/png" href="./favicon.png">
    <link rel="stylesheet" type="text/css" href="./styles.css" />
    <script type="text/javascript" src="./scripts.js"></script>
    <script type="text/javascript" src="./algolia.js"></script>
    <script type="text/javascript">
      var client = new AlgoliaSearch("07Y0OHK1NE", "e57db732fc8682a52448e177b5f0a248")
      var index = client.initIndex('tags')
    </script>
  </head>
  <body>

  <!-- dataLayer -->
<script>
  var dataLayer = dataLayer || [];
  dataLayer.push({
  "pageName": "/add"
  });
</script>
  <!-- End dataLayer -->

  <!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TPNLN5"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TPNLN5');</script>
<!-- End Google Tag Manager -->

    <div id="header">
      <div class="container">
        <a href="./"><div id="logo">Epic<strong>Skill</strong>Time</div></a>
        <div id="search">
          <input type="text" class="searchbox" placeholder="Game, player, hashtag..."></input>
          <div id="autocomplete"></div>
        </div>
        <div id="upload">
          <a href="./add.html"><button>Upload</button></a>
        </div>
      </div>
    </div>

    <div id="main">
      <div class="container" style="width: 720px;">
        <h1>Add an epic play</h1>

        <div class="card">
          <form id="add-form" method="post">
            <fieldset>
              <input autofocus name="url" id="url" type="text" placeholder="Gfycat URL (only gfycat for now)" />
            </fieldset>
            <fieldset>
              <select class="dimmed" name="game" id="game" type="text" />
              <option value="" disabled selected>Game (list will be extended in the future)</option>
              </select>
            </fieldset>
            <fieldset>
              <input name="title" type="text" id="title" maxlength="140" placeholder="Title (hashtags supported)" />
            </fieldset>
            <fieldset>
              <input type="submit" name="submit" onclick="dataLayer.push({'event': 'gfyUploaded'});" value="Upload" /> <span class="muted">Thanks for contributing!</span><br>
              <input name="free" type="text" hidden="true"/>
            </fieldset>
          </form>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      var form = document.getElementById('add-form')
      form.action = _EST_.APIdomain + '/add'
      form.addEventListener('submit', function (e) {
        var game = document.getElementById('game')
          , title = document.getElementById('title')
          , url = document.getElementById('url')

        if (game.value == '' || title.value == '' || url.value == '') {
          e.preventDefault()
          alert('Game over: all fields must be filled!')
        } else if (url.value.indexOf('gfycat.com') == -1) {
          e.preventDefault()
          alert('Game over: link must be a gfycat URL!')
        } else {
          _EST_.getHashtags();
        }
      }, false)

      _EST_.selectGames(function(lGames){

        var gameSelector = document.getElementsByName('game')[0]
        gameSelector.addEventListener('change', function(e){
          this.classList.remove('dimmed')
          if (this.value == "Other...") {
            if (confirm("Hey, we'd love to know from you what games you want to see in epic gifs. Tell us via email!")) {
              window.location.href = "mailto:ggwping@gmail.com?subject=Please add my favourite game!"
            }
            this.selectedIndex = 0
            this.classList.add('dimmed')
          }
        })

        var lGameNames = []

        for (var i=0, iLength = lGames.length; i < iLength; i++) {
          var sGame = lGames[i].content
          lGameNames.push(sGame)
        }

        lGameNames.sort()
        for (var i=0, iLength = lGameNames.length; i < iLength; i++) {
          var sGame = lGameNames[i]
          if (sGame != "") {
            var option = document.createElement('option')
            option.value = sGame
            option.textContent = sGame
            gameSelector.appendChild(option)
          }
        }
        var option = document.createElement('option')
        option.value = "Other..."
        option.textContent = "Other..."
        gameSelector.appendChild(option)

      })
      _EST_.listen()
      _EST_.templates.feedback()
    </script>
  </body>
</html>
